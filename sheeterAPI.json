{
  "openapi": "3.0.3",
  "info": {
    "title": "Sheeter API",
    "description": "Transform your Google Sheets into powerful APIs. Authenticate once with Google OAuth and get an API key to read, write, and manipulate Google Sheets programmatically.",
    "version": "1.0.0",
    "contact": {
      "name": "Sheeter API Support",
      "url": "https://sheeter-2.onrender.com"
    }
  },
  "servers": [
    {
      "url": "https://sheeter-2.onrender.com",
      "description": "Production server"
    },
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "security": [
    {
      "ApiKeyAuth": []
    }
  ],
  "paths": {
    "/auth/status": {
      "get": {
        "summary": "Check authentication status",
        "description": "Check if user is authenticated and has API access",
        "tags": ["Authentication"],
        "security": [],
        "responses": {
          "200": {
            "description": "Authentication status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthStatus"
                }
              }
            }
          }
        }
      }
    },
    "/auth/google": {
      "get": {
        "summary": "Start Google OAuth flow",
        "description": "Redirects to Google OAuth consent screen for authentication and Sheets access",
        "tags": ["Authentication"],
        "security": [],
        "responses": {
          "302": {
            "description": "Redirect to Google OAuth"
          }
        }
      }
    },
    "/auth/revoke": {
      "post": {
        "summary": "Revoke API access",
        "description": "Revoke Google Sheets access and delete API key",
        "tags": ["Authentication"],
        "responses": {
          "200": {
            "description": "Access revoked successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/test": {
      "get": {
        "summary": "Test JWT authentication",
        "description": "Test endpoint to verify JWT-based authentication works",
        "tags": ["Testing"],
        "responses": {
          "200": {
            "description": "Authentication test successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TestResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/test-key": {
      "get": {
        "summary": "Test API key authentication",
        "description": "Test endpoint to verify API key authentication works",
        "tags": ["Testing"],
        "responses": {
          "200": {
            "description": "API key test successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TestResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/create": {
      "post": {
        "summary": "Create new spreadsheet",
        "description": "Create a new Google Spreadsheet",
        "tags": ["Spreadsheet Management"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title"],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Title for the new spreadsheet",
                    "example": "My New Spreadsheet"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Spreadsheet created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Successfully created spreadsheet: \"My New Spreadsheet\""
                    },
                    "spreadsheetId": {
                      "type": "string",
                      "example": "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                    },
                    "spreadsheetUrl": {
                      "type": "string",
                      "example": "https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}": {
      "get": {
        "summary": "Read sheet data",
        "description": "Read values from a single range in a Google Sheet",
        "tags": ["Reading Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          },
          {
            "name": "range",
            "in": "query",
            "description": "A1 notation range (e.g., A1:D10, Sheet1!A1:B5)",
            "schema": {
              "type": "string",
              "default": "A:Z"
            }
          },
          {
            "name": "majorDimension",
            "in": "query",
            "description": "The major dimension that results should use",
            "schema": {
              "type": "string",
              "enum": ["ROWS", "COLUMNS"],
              "default": "ROWS"
            }
          },
          {
            "name": "valueRenderOption",
            "in": "query",
            "description": "How values should be represented in the output",
            "schema": {
              "type": "string",
              "enum": ["FORMATTED_VALUE", "UNFORMATTED_VALUE", "FORMULA"],
              "default": "FORMATTED_VALUE"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sheet data retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/batch-get": {
      "post": {
        "summary": "Read multiple ranges",
        "description": "Read values from multiple ranges in a Google Sheet",
        "tags": ["Reading Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["ranges"],
                "properties": {
                  "ranges": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "List of A1 notation ranges",
                    "example": ["A1:B10", "D1:E5", "Sheet2!A1:C3"]
                  },
                  "majorDimension": {
                    "type": "string",
                    "enum": ["ROWS", "COLUMNS"],
                    "default": "ROWS"
                  },
                  "valueRenderOption": {
                    "type": "string",
                    "enum": ["FORMATTED_VALUE", "UNFORMATTED_VALUE", "FORMULA"],
                    "default": "FORMATTED_VALUE"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Multiple ranges retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchGetResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/values": {
      "put": {
        "summary": "Update sheet data",
        "description": "Update values in a single range of a Google Sheet",
        "tags": ["Writing Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sheet updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      },
      "delete": {
        "summary": "Clear range values",
        "description": "Clear values from a specific range in a Google Sheet",
        "tags": ["Writing Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          },
          {
            "name": "range",
            "in": "query",
            "required": true,
            "description": "A1 notation range to clear",
            "schema": {
              "type": "string",
              "example": "A1:B10"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Range cleared successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ClearResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/batch-update": {
      "put": {
        "summary": "Update multiple ranges",
        "description": "Update values in multiple ranges of a Google Sheet",
        "tags": ["Writing Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["data"],
                "properties": {
                  "data": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/ValueRange"
                    },
                    "description": "List of ranges and their values to update"
                  },
                  "valueInputOption": {
                    "type": "string",
                    "enum": ["RAW", "USER_ENTERED"],
                    "default": "USER_ENTERED"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch update successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchUpdateResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/append": {
      "post": {
        "summary": "Append data to sheet",
        "description": "Append values to the end of a Google Sheet",
        "tags": ["Writing Data"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["values"],
                "properties": {
                  "range": {
                    "type": "string",
                    "default": "A1",
                    "description": "Starting range for append operation"
                  },
                  "values": {
                    "type": "array",
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "description": "2D array of values to append",
                    "example": [["John", "25"], ["Jane", "30"]]
                  },
                  "valueInputOption": {
                    "type": "string",
                    "enum": ["RAW", "USER_ENTERED"],
                    "default": "USER_ENTERED"
                  },
                  "insertDataOption": {
                    "type": "string",
                    "enum": ["OVERWRITE", "INSERT_ROWS"],
                    "default": "OVERWRITE"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Data appended successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppendResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/batch-update-spreadsheet": {
      "post": {
        "summary": "Advanced spreadsheet operations",
        "description": "Perform complex operations like find/replace, formatting, adding sheets, etc.",
        "tags": ["Advanced Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["requests"],
                "properties": {
                  "requests": {
                    "type": "array",
                    "items": {
                      "type": "object"
                    },
                    "description": "Array of batch update requests",
                    "example": [
                      {
                        "findReplace": {
                          "find": "old text",
                          "replacement": "new text",
                          "allSheets": true
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch operation successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchOperationResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/rows": {
      "delete": {
        "summary": "Delete rows",
        "description": "Delete specific rows from a Google Sheet",
        "tags": ["Advanced Operations"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          },
          {
            "name": "startIndex",
            "in": "query",
            "required": true,
            "description": "Start index of rows to delete (0-based)",
            "schema": {
              "type": "integer",
              "minimum": 0
            }
          },
          {
            "name": "endIndex",
            "in": "query",
            "required": true,
            "description": "End index of rows to delete (exclusive, 0-based)",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "sheetTabId",
            "in": "query",
            "description": "ID of the sheet tab (0 for first sheet)",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Rows deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteRowsResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/sheets/{sheetId}/metadata": {
      "get": {
        "summary": "Get spreadsheet metadata",
        "description": "Get information about a Google Spreadsheet including sheets, properties, etc.",
        "tags": ["Spreadsheet Management"],
        "parameters": [
          {
            "$ref": "#/components/parameters/SheetId"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MetadataResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "API key authentication. Use 'Bearer sk_your_api_key'"
      }
    },
    "parameters": {
      "SheetId": {
        "name": "sheetId",
        "in": "path",
        "required": true,
        "description": "Google Spreadsheet ID",
        "schema": {
          "type": "string",
          "example": "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
        }
      }
    },
    "schemas": {
      "AuthStatus": {
        "type": "object",
        "properties": {
          "authenticated": {
            "type": "boolean"
          },
          "hasAccess": {
            "type": "boolean"
          },
          "apiKey": {
            "type": "string",
            "nullable": true
          },
          "userEmail": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          }
        }
      },
      "TestResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "sheetName": {
            "type": "string"
          },
          "sheetId": {
            "type": "string"
          },
          "rowCount": {
            "type": "integer"
          },
          "sampleData": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "message": {
            "type": "string"
          },
          "userEmail": {
            "type": "string"
          },
          "authenticatedAs": {
            "type": "string"
          }
        }
      },
      "ReadResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "range": {
            "type": "string"
          },
          "majorDimension": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "Array of objects with headers as keys"
          },
          "headers": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rowCount": {
            "type": "integer"
          }
        }
      },
      "BatchGetResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "spreadsheetId": {
            "type": "string"
          },
          "valueRanges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ValueRange"
            }
          }
        }
      },
      "ValueRange": {
        "type": "object",
        "properties": {
          "range": {
            "type": "string"
          },
          "majorDimension": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "UpdateRequest": {
        "type": "object",
        "required": ["range", "values"],
        "properties": {
          "range": {
            "type": "string",
            "description": "A1 notation range",
            "example": "A1:B2"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "2D array of values",
            "example": [["Name", "Age"], ["John", "25"]]
          },
          "valueInputOption": {
            "type": "string",
            "enum": ["RAW", "USER_ENTERED"],
            "default": "USER_ENTERED"
          },
          "majorDimension": {
            "type": "string",
            "enum": ["ROWS", "COLUMNS"],
            "default": "ROWS"
          }
        }
      },
      "UpdateResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "spreadsheetId": {
            "type": "string"
          },
          "updatedRange": {
            "type": "string"
          },
          "updatedRows": {
            "type": "integer"
          },
          "updatedColumns": {
            "type": "integer"
          },
          "updatedCells": {
            "type": "integer"
          }
        }
      },
      "BatchUpdateResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "spreadsheetId": {
            "type": "string"
          },
          "totalUpdatedRows": {
            "type": "integer"
          },
          "totalUpdatedColumns": {
            "type": "integer"
          },
          "totalUpdatedCells": {
            "type": "integer"
          },
          "totalUpdatedSheets": {
            "type": "integer"
          },
          "responses": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "AppendResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "spreadsheetId": {
            "type": "string"
          },
          "tableRange": {
            "type": "string"
          },
          "updates": {
            "type": "object",
            "properties": {
              "spreadsheetId": {
                "type": "string"
              },
              "updatedRange": {
                "type": "string"
              },
              "updatedRows": {
                "type": "integer"
              },
              "updatedColumns": {
                "type": "integer"
              },
              "updatedCells": {
                "type": "integer"
              }
            }
          }
        }
      },
      "ClearResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "spreadsheetId": {
            "type": "string"
          },
          "clearedRange": {
            "type": "string"
          }
        }
      },
      "BatchOperationResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "spreadsheetId": {
            "type": "string"
          },
          "replies": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "DeleteRowsResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "replies": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "MetadataResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "spreadsheetId": {
            "type": "string"
          },
          "properties": {
            "type": "object",
            "properties": {
              "title": {
                "type": "string"
              },
              "locale": {
                "type": "string"
              },
              "autoRecalc": {
                "type": "string"
              },
              "timeZone": {
                "type": "string"
              }
            }
          },
          "sheets": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "sheetId": {
                  "type": "integer"
                },
                "title": {
                  "type": "string"
                },
                "index": {
                  "type": "integer"
                },
                "sheetType": {
                  "type": "string"
                },
                "gridProperties": {
                  "type": "object",
                  "properties": {
                    "rowCount": {
                      "type": "integer"
                    },
                    "columnCount": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string"
          }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Bad request - invalid parameters",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Unauthorized - invalid or missing API key",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "NotFound": {
        "description": "Not found - spreadsheet or resource doesn't exist",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Authentication",
      "description": "OAuth authentication and API key management"
    },
    {
      "name": "Testing",
      "description": "Test endpoints to verify authentication"
    },
    {
      "name": "Spreadsheet Management",
      "description": "Create and manage Google Spreadsheets"
    },
    {
      "name": "Reading Data",
      "description": "Read data from Google Sheets"
    },
    {
      "name": "Writing Data",
      "description": "Write and update data in Google Sheets"
    },
    {
      "name": "Advanced Operations",
      "description": "Complex operations like formatting, find/replace, row deletion"
    }
  ]
}